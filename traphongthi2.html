<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xem l·ªãch thi</title>
    <style>
        :root {
            --primary: #3498db;
            --bg: #f0f2f5;
            --danger: #e74c3c;
            --success: #2ecc71;
            --orange: #e67e22;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 8px;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .header-controls {
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 8px;
        }

        .input-row {
            display: flex;
            flex-wrap: nowrap;
            gap: 6px;
            align-items: center;
        }

        input {
            flex: 1;
            min-width: 0;
            padding: 12px;
            border: 2px solid #3498db;
            border-radius: 8px;
            outline: none;
            font-size: 14px;
        }

        button {
            padding: 12px 14px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .btn-paste {
            background: var(--success);
        }

        .btn-upload {
            background: var(--orange);
        }

        .btn-clear {
            background: var(--danger);
        }

        .marquee-container {
            background: #fff3e0;
            border-radius: 6px;
            padding: 8px 0;
            overflow: hidden;
            display: flex;
            border: 1px solid #ffcc80;
        }

        .marquee-content {
            display: flex;
            white-space: nowrap;
            animation: marquee-infinite 35s linear infinite;
        }

        .marquee-content:hover {
            animation-play-state: paused;
        }

        .text-item {
            padding-right: 60px;
            color: #d35400;
            font-weight: bold;
            font-size: 13.5px;
        }

        @keyframes marquee-infinite {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        .viewer-container {
            flex: 1;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            border: 1px solid #ddd;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .excel-mode {
            height: calc(100% + 65px);
            margin-top: -40px;
        }

        #placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #999;
            text-align: center;
            width: 90%;
        }
    </style>
</head>

<body>

    <div class="header-controls">
        <div class="input-row">
            <button type="button" class="btn-paste" onclick="pasteAndLoad()">üöÄ D√ÅN</button>
            <input type="text" id="fileUrl" placeholder="D√°n link ho·∫∑c ch·ªçn file..." autocomplete="off">

            <input type="file" id="fileInput" hidden accept=".pdf,.xlsx,.xls" onchange="handleFileUpload(this)">
            <button type="button" class="btn-upload" onclick="document.getElementById('fileInput').click()">üìÅ T·∫¢I
                FILE</button>

            <button type="button" class="btn-clear" onclick="clearLink()">üóëÔ∏è X√ìA</button>
        </div>

        <div class="marquee-container">
            <div class="marquee-content">
                <div class="text-item">
                    üîó H·ªñ TR·ª¢ EXCEL & PDF: D√°n link t·ª´ trang PƒêT ho·∫∑c b·∫•m "T·∫¢I FILE" ƒë·ªÉ ch·ªçn file t·ª´ m√°y. üí° M·∫∏O: V·ªõi
                    Excel, d√πng K√≠nh l√∫p üîç. V·ªõi PDF, nh·∫•n Ctrl+F ƒë·ªÉ t√¨m MSSV nhanh h∆°n.
                </div>
                <div class="text-item">
                    üîó H·ªñ TR·ª¢ EXCEL & PDF: D√°n link t·ª´ trang PƒêT ho·∫∑c b·∫•m "T·∫¢I FILE" ƒë·ªÉ ch·ªçn file t·ª´ m√°y. üí° M·∫∏O: V·ªõi
                    Excel, d√πng K√≠nh l√∫p üîç. V·ªõi PDF, nh·∫•n Ctrl+F ƒë·ªÉ t√¨m MSSV nhanh h∆°n.
                </div>
            </div>
        </div>
    </div>

    <div class="viewer-container">
        <div id="placeholder">
            <b>H·ªá th·ªëng ƒëang ch·ªù link ho·∫∑c file danh s√°ch thi...</b>
        </div>
        <iframe id="fileViewer" src="" style="display: none;"></iframe>
    </div>

    <script>
        // L∆∞u tr·ªØ URL t·∫°m th·ªùi ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ
        let currentObjectUrl = null;

        async function pasteAndLoad() {
            try {
                const text = await navigator.clipboard.readText();
                if (text && (text.includes('http'))) {
                    document.getElementById('fileUrl').value = text;
                    loadContent();
                } else {
                    alert('N·ªôi dung ƒë√£ ch√©p kh√¥ng ch·ª©a link!');
                }
            } catch (err) {
                alert('Vui l√≤ng cho ph√©p truy c·∫≠p Clipboard.');
            }
        }

        function handleFileUpload(input) {
            const file = input.files[0];
            if (!file) return;

            // X√≥a URL c≈© n·∫øu c√≥ ƒë·ªÉ tr√°nh r√≤ r·ªâ b·ªô nh·ªõ
            if (currentObjectUrl) URL.revokeObjectURL(currentObjectUrl);

            document.getElementById('fileUrl').value = `File: ${file.name}`;
            currentObjectUrl = URL.createObjectURL(file);

            const isPdf = file.name.toLowerCase().endsWith('.pdf');
            displayFile(currentObjectUrl, isPdf, true);
        }

        function clearLink() {
            document.getElementById('fileUrl').value = '';
            document.getElementById('fileInput').value = '';
            if (currentObjectUrl) URL.revokeObjectURL(currentObjectUrl);

            const viewer = document.getElementById('fileViewer');
            const placeholder = document.getElementById('placeholder');
            viewer.src = '';
            viewer.style.display = 'none';
            viewer.classList.remove('excel-mode');
            placeholder.style.display = 'block';
        }

        function loadContent() {
            const url = document.getElementById('fileUrl').value.trim();
            if (!url || url.startsWith('File: ')) return;

            const isPdf = url.toLowerCase().split('?')[0].endsWith('.pdf');
            displayFile(url, isPdf, false);
        }

        function displayFile(url, isPdf, isLocalFile) {
            const viewer = document.getElementById('fileViewer');
            const placeholder = document.getElementById('placeholder');
            let finalUrl = "";

            if (isPdf) {
                // N·∫øu l√† file PDF c·ª•c b·ªô, hi·ªÉn th·ªã tr·ª±c ti·∫øp b·∫±ng tr√¨nh duy·ªát. 
                // N·∫øu l√† link web, d√πng Google Viewer.
                finalUrl = isLocalFile ? url : `https://docs.google.com/viewer?url=${encodeURIComponent(url)}&embedded=true`;
                viewer.classList.remove('excel-mode');
            } else {
                // V·ªõi Excel: Ch·ªâ hi·ªÉn th·ªã ƒë∆∞·ª£c qua Office Online n·∫øu c√≥ link web. 
                // L∆∞u √Ω: File Excel c·ª•c b·ªô kh√¥ng th·ªÉ xem tr·ª±c ti·∫øp qua iframe Office Online.
                if (isLocalFile) {
                    alert("L∆∞u √Ω: Tr√¨nh xem tr·ª±c tuy·∫øn kh√¥ng h·ªó tr·ª£ xem tr·ª±c ti·∫øp file Excel t·ª´ m√°y t√≠nh v√¨ l√Ω do b·∫£o m·∫≠t c·ªßa Microsoft. Vui l√≤ng s·ª≠ d·ª•ng Link ho·∫∑c chuy·ªÉn file sang PDF.");
                    clearLink();
                    return;
                }
                const officeParams = '&wdInNav=0&activeCell=A1&wdActiveSheet=Sheet1';
                finalUrl = `https://view.officeapps.live.com/op/view.aspx?src=${encodeURIComponent(url)}${officeParams}`;
                viewer.classList.add('excel-mode');
            }

            placeholder.style.display = 'none';
            viewer.style.display = 'block';
            viewer.src = finalUrl;
        }

        document.getElementById('fileUrl').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loadContent();
        });
    </script>
</body>

</html>
