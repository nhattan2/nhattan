<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Danh s√°ch thi</title>
    <link rel="icon" href="logoo.png"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
        /* --- CSS: C·∫§U TR√öC LAYOUT C·ªê ƒê·ªäNH (APP STYLE) --- */
        :root {
            --primary-color: #007bff;
            --bg-color: #f4f4f9;
            --container-bg: #fff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: #333;
            /* S·ª≠ d·ª•ng dvh ƒë·ªÉ fix l·ªói thanh ƒë·ªãa ch·ªâ tr√™n mobile */
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 1500px;
            /* Full chi·ªÅu cao tr√™n mobile */
            height: 100%;
            background: var(--container-bg);
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            .container {
                width: 95%;
                height: 95vh;
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }
        }

        /* --- PH·∫¶N C·ªê ƒê·ªäNH (HEADER + SEARCH) --- */
        .fixed-header {
            flex-shrink: 0;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin: 5px 0 10px 0;
            font-size: 1.3em;
            text-transform: uppercase;
        }

        #search-box {
            width: 100%;
            padding: 12px 15px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            /* Font 16px tr√°nh zoom tr√™n iOS */
            transition: border-color 0.3s;
            background: #f9f9f9;
        }

        #search-box:focus {
            border-color: var(--primary-color);
            outline: none;
            background: #fff;
        }

        .status-bar {
            font-size: 0.75rem;
            color: #888;
            margin-top: 5px;
            text-align: center;
            /* CƒÉn gi·ªØa tr√™n mobile cho ƒë·∫πp */
            height: auto;
            min-height: 15px;
        }

        /* --- PH·∫¶N CU·ªòN (DANH S√ÅCH THI) --- */
        .exam-list-wrapper {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 2px;
            padding-top: 5px;
            -webkit-overflow-scrolling: touch;
        }

        #exam-list {
            display: grid;
            grid-template-columns: 1fr;
            /* 1 c·ªôt tr√™n mobile */
            gap: 10px;
            padding-bottom: 20px;
        }

        @media (min-width: 600px) {
            #exam-list {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }

        @media (min-width: 900px) {
            #exam-list {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* --- STYLE CHO T·ª™NG TH·∫∫ (CARD) --- */
        .exam-item {
            background-color: #fff;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #eee;
            border-left: 5px solid var(--primary-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: transform 0.1s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .exam-item:active {
            transform: scale(0.98);
        }

        .exam-content {
            flex-grow: 1;
            overflow-wrap: break-word;
            margin-bottom: 8px;
        }

        .exam-title a {
            font-weight: 600;
            color: inherit;
            text-decoration: none;
            font-size: 1rem;
            display: block;
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .meta-info {
            font-size: 0.85em;
            color: #555;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 4px;
        }

        .upload-date {
            font-size: 0.75em;
            color: #999;
            border-top: 1px dashed #eee;
            padding-top: 6px;
            text-align: right;
        }

        /* --- SKELETON LOADING --- */
        .skeleton {
            background-color: #f0f0f0;
            border-radius: 8px;
            height: 100px;
            position: relative;
            overflow: hidden;
        }

        /* (Animation shimmer gi·ªØ nguy√™n) */
        .skeleton::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            transform: translateX(-100%);
            background-image: linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0.2) 20%, rgba(255, 255, 255, 0.5) 60%, rgba(255, 255, 255, 0));
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }

        .error,
        .no-results {
            text-align: center;
            grid-column: 1 / -1;
            padding: 20px;
            font-size: 1em;
            color: #666;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="fixed-header">
            <h1>Danh s√°ch thi</h1>
            <input type="text" id="search-box" placeholder="T√¨m m√¥n, m√£ m√¥n..." autocomplete="off">
            <div id="status-bar" class="status-bar"></div>
        </div>

        <div class="exam-list-wrapper">
            <div id="exam-list">
            </div>
        </div>
    </div>
    <script src="lock_system.js"></script>
    <script>
        // --- GI·ªÆ NGUY√äN TO√ÄN B·ªò SCRIPT G·ªêC (KH√îNG CH·ªàNH S·ª¨A LOGIC) ---
        const CONFIG = { ORIGINAL_API: 'https://tidtu-worker-examlist.ngtuonghy.workers.dev/api/v1/pdaotao/scraping/examlist', PROXY: 'https://api.codetabs.com/v1/proxy/?quest=', BASE_URL: 'https://pdaotao.duytan.edu.vn/', CACHE_KEY: 'DTU_EXAM_CACHE_V1', CACHE_TIME_KEY: 'DTU_EXAM_LAST_UPDATE', REFRESH_INTERVAL: 120000 }; const COLOR_PALETTE = ['#4a90e2', '#28a745', '#ffc107', '#dc3545', '#6f42c1', '#fd7e14', '#17a2b8', '#e83e8c', '#00bcd4', '#ffeb3b', '#8bc34a', '#ff9800', '#f44336', '#9c27b0', '#607d8b', '#009688', '#ff5722', '#673ab7', '#3f51b5', '#03a9f4', '#007bff', '#20c997', '#adb5bd', '#343a40']; const dom = { list: document.getElementById('exam-list'), search: document.getElementById('search-box'), status: document.getElementById('status-bar') }; let allExams = []; const dateColorMap = new Map(); const parseDate = (dateString) => { try { const [d, m, y] = dateString.split(' ')[1].split('/'); return new Date(y, m - 1, d); } catch { return null; } }; const getColorByDate = (dateString) => { const d = parseDate(dateString); if (!d) return '#6c757d'; const key = `${d.getDate()}/${d.getMonth()}/${d.getFullYear()}`; if (!dateColorMap.has(key)) { dateColorMap.set(key, COLOR_PALETTE[dateColorMap.size % COLOR_PALETTE.length]); } return dateColorMap.get(key); }; const isNew = (dateString) => { const d = parseDate(dateString); if (!d) return false; const today = new Date(); today.setHours(0, 0, 0, 0); const check = new Date(d); check.setHours(0, 0, 0, 0); return (today - check) <= (3 * 86400000); }; function renderSkeleton() { dom.list.innerHTML = Array(8).fill('<div class="skeleton"></div>').join(''); }
        function renderExams(data) {
            if (!data || data.length === 0) { dom.list.innerHTML = '<div class="no-results">‚úÖ Kh√¥ng t√¨m th·∫•y l·ªãch thi ph√π h·ª£p.</div>'; return; }
            const html = data.map(exam => {
                const itemColor = getColorByDate(exam.uploadDate); const url = CONFIG.BASE_URL + exam.examDetailsUrl; let displayTitle = exam.examTitle; let metaInfo = ''; const parts = exam.examTitle.split('_'); if (parts.length >= 4 && /^\d{8}$/.test(parts[0])) {
                    displayTitle = parts.slice(3).join(' ').trim() || exam.examTitle; const datePart = parts[0].replace(/(\d{2})(\d{2})(\d{4})/, '$1/$2/$3'); const timePart = parts[1].replace('H', ':');
                    // C·∫¨P NH·∫¨T NH·ªé HTML TRONG JS ƒê·ªÇ KH·ªöP STYLE M·ªöI (CH·ªà HTML STRING, KO LOGIC)
                    metaInfo = `<div class="meta-info"><span>üóìÔ∏è ${datePart}</span> <span>‚è±Ô∏è ${timePart}</span> <span>üè∑Ô∏è ${parts[2]}</span></div>`;
                }
                const newLabel = isNew(exam.uploadDate) ? `<span style="background-color:${itemColor};color:#fff;padding:1px 5px;border-radius:4px;font-size:0.7em;margin-left:5px;vertical-align:middle">NEW</span>` : ''; return `
                <div class="exam-item" style="border-left-color: ${itemColor};">
                    <div class="exam-content">
                        <div class="exam-title">
                            <a href="${url}" target="_blank" style="color: ${itemColor};">
                                ${displayTitle} ${newLabel}
                            </a>
                        </div>
                        ${metaInfo ? metaInfo : ''}
                    </div>
                    <div class="upload-date">T·∫£i l√∫c: ${exam.uploadDate}</div>
                </div>`;
            }).join(''); dom.list.innerHTML = html;
        }
        async function loadData() { const cachedData = localStorage.getItem(CONFIG.CACHE_KEY); const lastUpdate = localStorage.getItem(CONFIG.CACHE_TIME_KEY); if (cachedData) { allExams = JSON.parse(cachedData); renderExams(allExams); if (lastUpdate) dom.status.innerHTML = `üîÑ D·ªØ li·ªáu c≈©: ${lastUpdate}. ƒêang t·∫£i...`; } else { renderSkeleton(); dom.status.innerHTML = `üîÑ ƒêang t·∫£i...`; } try { const response = await fetch(CONFIG.PROXY + encodeURIComponent(CONFIG.ORIGINAL_API)); if (!response.ok) throw new Error(`HTTP ${response.status}`); const json = await response.json(); const newData = json.response?.data || []; if (newData.length > 0 && JSON.stringify(newData) !== cachedData) { allExams = newData; allExams.sort((a, b) => (parseDate(b.uploadDate) || 0) - (parseDate(a.uploadDate) || 0)); renderExams(allExams); const now = new Date().toLocaleString('vi-VN'); localStorage.setItem(CONFIG.CACHE_KEY, JSON.stringify(allExams)); localStorage.setItem(CONFIG.CACHE_TIME_KEY, now); dom.status.innerHTML = `‚úÖ C·∫≠p nh·∫≠t: ${now}`; } else { dom.status.innerHTML = `‚úÖ M·ªõi nh·∫•t (${lastUpdate})`; } } catch (error) { if (cachedData) { dom.status.innerHTML = `‚ö†Ô∏è L·ªói t·∫£i. ƒêang xem b·∫£n offline.`; dom.status.style.color = '#d9534f'; } else { dom.list.innerHTML = `<div class="error">‚ùå L·ªói t·∫£i d·ªØ li·ªáu.<br>${error.message}</div>`; } } } let timeoutId; dom.search.addEventListener('keyup', (e) => { clearTimeout(timeoutId); timeoutId = setTimeout(() => { const query = e.target.value.toLowerCase().trim(); const filtered = allExams.filter(exam => `${exam.examTitle} ${exam.uploadDate}`.toLowerCase().includes(query)); renderExams(filtered); }, 300); }); loadData(); setInterval(loadData, CONFIG.REFRESH_INTERVAL);
    </script>
</body>


</html>


