<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªùi Kh√≥a Bi·ªÉu ƒêƒÉng K√Ω T√≠n Ch·ªâ</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .tabs {
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.7);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .tab-button {
            background-color: transparent;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #555;
            transition: background-color 0.3s, color 0.3s;
        }

        .tab-button.active {
            background-color: #4CAF50;
            color: white;
            border-radius: 8px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        .container {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            max-width: 1200px;
            width: 100%;
        }

        .page {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .input-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 15px;
        }

        .input-row label {
            font-weight: bold;
            margin-right: 10px;
            width: 120px;
            color: #333;
        }

        .input-row input,
        .input-row select {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-right: 20px;
            transition: border-color 0.3s;
        }

        .input-row input:focus,
        .input-row select:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
        }

        #campus-location-field,
        .campus-location-field {
            display: flex;
            flex-grow: 1;
            align-items: center;
        }

        #campus-location-field label,
        .campus-location-field label {
            width: 80px;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .file-action-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .add-course-btn {
            background-color: #87f765;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }

        .add-session-btn {
            background-color: #e87070;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }

        .add-course-btn:hover,
        .add-session-btn:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }

        .file-action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }

        .export-btn {
            background-color: #ff9800;
            color: white;
        }

        .export-btn:hover {
            background-color: #f57c00;
            transform: translateY(-2px);
        }

        .import-btn {
            background-color: #007bff;
            color: white;
        }

        .import-btn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        .clear-all-btn {
            background-color: #dc3545;
            color: white;
        }

        .clear-all-btn:hover {
            background-color: #c82333;
            transform: translateY(-2px);
        }

        .custom-file-upload input[type="file"] {
            display: none;
        }

        .timetable-switch-buttons {
            text-align: center;
            margin-bottom: 15px;
        }

        .timetable-button {
            background-color: #ddd;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            margin: 0 5px;
            transition: background-color 0.3s, color 0.3s;
        }

        .timetable-button.active {
            background-color: #4CAF50;
            color: white;
        }

        /* Updated style for sticky header */
        .timetable-display {
            overflow-x: auto;
            overflow-y: auto;
            /* Enable vertical scrolling */
            max-height: 500px;
            /* Set a max height to make it scrollable */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            table-layout: fixed;
        }

        /* Sticky header styles */
        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
            word-wrap: break-word;
            vertical-align: top;
            height: 40px;
        }

        th {
            background-color: #d8f5d8;
            font-weight: bold;
            position: sticky;
            /* Make the header sticky */
            top: 0;
            /* Stick to the top of the container */
            z-index: 10;
            /* Ensure it stays on top of other content */
        }

        td.time-label {
            background-color: #f9f9f9;
            font-weight: bold;
        }

        .online-class {
            background-color: #e0f2f1;
            border-left: 5px solid #009688;
        }

        .campus-class {
            background-color: #fffde7;
            border-left: 5px solid #ffc107;
        }

        .danger {
            background-color: #ffebee !important;
            color: #c62828 !important;
        }

        .remove-btn,
        .remove-session-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
            margin-left: 5px;
        }

        .remove-btn:hover,
        .remove-session-btn:hover {
            background-color: #c82333;
        }

        .course-summary {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            font-size: 1.1em;
        }

        .course-summary p {
            margin: 5px 0;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
        }

        .checkbox-group label {
            margin-bottom: 5px;
        }

        /* Custom Alert Styles */
        .alert-container {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
        }

        .alert-box {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            /* D√íNG N√ÄY CƒÇN GI·ªÆA ICON V√Ä N√öT OK */
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            border-left: 5px solid #dc3545;
            /* M·∫∑c ƒë·ªãnh m√†u ƒë·ªè cho alert-box l·ªói */
        }

        .alert-box.success {
            border-left: 5px solid #28a745;
        }

        .alert-icon {
            font-size: 40px;
            /* CƒÇN GI·ªÆA ICON B·∫∞NG MARGIN V√Ä WIDTH */
            margin: 0 auto 10px auto;
            display: block;
            width: fit-content;
        }

        .alert-icon.success::after {
            content: 'üëç';
        }

        .alert-icon.error::after {
            content: '‚ö†Ô∏è';
        }

        /* TI√äU ƒê·ªÄ */
        .alert-box .alert-title {
            font-size: 1.6em;
            font-weight: 700;
            display: block;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            color: #dc3545;
            /* M√†u ƒë·ªè cho ti√™u ƒë·ªÅ */
            text-align: center;
            /* CƒÇN GI·ªÆA TI√äU ƒê·ªÄ */
        }

        /* N·ªòI DUNG CHUNG (CH·ª®A C·∫¢ MESSAGE V√Ä DETAIL) */
        #alert-message {
            font-size: 1.0em;
            font-weight: normal;
            color: #333;
            margin-bottom: 20px;
            text-align: left;
            /* CƒÇN TR√ÅI N·ªòI DUNG */
            display: block;
        }

        /* KH·ªêI HI·ªÇN TH·ªä CHI TI·∫æT L·ªñI (CONFLICT DETAIL) */
        .alert-box .conflict-detail {
            background-color: #f8d7da;
            /* N·ªÅn h·ªìng nh·∫°t */
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: left;
            color: #a71d2a;
        }

        .alert-box .conflict-detail b {
            font-size: 1.1em;
        }

        /* N√öT OK */
        #alert-ok-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            /* N√∫t ƒë√£ ƒë∆∞·ª£c cƒÉn gi·ªØa b·ªüi text-align: center c·ªßa .alert-box */
        }

        #alert-ok-btn:hover {
            background-color: #388e3c;
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* ... (Gi·ªØ nguy√™n c√°c quy t·∫Øc v·ªÅ form, b·∫£ng, v.v.) ... */
        .input-group {
            flex: 1;
            min-width: 250px;
        }

        .input-row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .input-row input,
        .input-row select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        .form-columns {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .form-column {
            flex: none;
            width: 100%;
        }

        h2,
        h3 {
            text-align: center;
            color: #444;
        }
    </style>

</head>

<body>

    <div class="tabs">
        <button class="tab-button active" onclick="showPage('page1')">Nh·∫≠p M√¥n H·ªçc</button>
        <button class="tab-button" onclick="showPage('page2')">Th·ªùi Kh√≥a Bi·ªÉu</button>
        <button class="tab-button" onclick="showPage('page3')">M√¥n ƒê√£ ƒêƒÉng K√Ω</button>
        <button class="tab-button" onclick="showPage('page4')">H·ªçc Ph√≠</button>
    </div>

    <div class="container">
        <div id="page1" class="page">
            <h2>Nh·∫≠p th√¥ng tin m√¥n h·ªçc</h2>
            <form id="course-form" autocomplete="off">


                <div class="input-row">
                    <div class="input-group">
                        <label for="course-name">T√™n m√¥n h·ªçc:</label>
                        <input type="text" id="course-name" required autocomplete="off"
                            placeholder="VD: Tri·∫øt H·ªçc Marx - Lenin">
                    </div>
                    <div class="input-group">
                        <label for="class-code">M√£ l·ªõp:</label>
                        <input type="text" id="class-code" required autocomplete="off" placeholder="VD: L01">
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label for="reg-code">M√£ ƒëƒÉng k√Ω:</label>
                        <input type="text" id="reg-code" required autocomplete="off" placeholder="VD: 12345678">
                    </div>
                    <div class="input-group">
                        <label for="semester-week">Tu·∫ßn h·ªçc (Gƒê):</label>
                        <select id="semester-week" required>
                            <option value="">-- Ch·ªçn --</option>
                            <option value="Giai ƒëo·∫°n 1">Giai ƒëo·∫°n 1</option>
                            <option value="Giai ƒëo·∫°n 2">Giai ƒëo·∫°n 2</option>
                            <option value="C·∫£ 2 giai ƒëo·∫°n">C·∫£ 2 giai ƒëo·∫°n</option>
                        </select>
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label for="lecturer">Gi·∫£ng vi√™n:</label>
                        <input type="text" id="lecturer" required autocomplete="off" placeholder="VD: Nguy·ªÖn VƒÉn A">
                    </div>
                    <div class="input-group">
                        <label for="credits">S·ªë t√≠n ch·ªâ:</label>
                        <select id="credits" required>
                            <option value="">-- Ch·ªçn --</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                </div>

                <h3>Th·ªùi gian h·ªçc</h3>
                <div id="class-sessions-container">
                    <div class="class-session-row">
                        <div class="input-row">
                            <div class="input-group">
                                <label for="day-of-week-0">Th·ª©:</label>
                                <select id="day-of-week-0" class="day-of-week" required>
                                    <option value="">-- Ch·ªçn --</option>
                                    <option value="T2">T2</option>
                                    <option value="T3">T3</option>
                                    <option value="T4">T4</option>
                                    <option value="T5">T5</option>
                                    <option value="T6">T6</option>
                                    <option value="T7">T7</option>
                                    <option value="CN">CN</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="time-0">Gi·ªù h·ªçc:</label>
                                <select id="time-0" class="time" required>
                                    <option value="">-- Ch·ªçn --</option>
                                    <option value="07:00-09:00">07:00 - 09:00</option>
                                    <option value="07:00-10:15">07:00 - 10:15</option>
                                    <option value="07:00-11:15">07:00 - 11:15</option>
                                    <option value="09:15-11:15">09:15 - 11:15</option>
                                    <option value="13:00-15:00">13:00 - 15:00</option>
                                    <option value="13:00-16:15">13:00 - 16:15</option>
                                    <option value="13:00-17:15">13:00 - 17:15</option>
                                    <option value="15:15-17:15">15:15 - 17:15</option>
                                    <option value="17:45-21:00">17:45 - 21:00</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-row">
                            <label for="location-type-0">Lo·∫°i ƒë·ªãa ƒëi·ªÉm:</label>
                            <select id="location-type-0" class="location-type" required>
                                <option value="">-- Ch·ªçn --</option>
                                <option value="online">Online</option>
                                <option value="campus">C∆° s·ªü</option>
                            </select>
                            <div class="campus-location-field" style="display:none;">
                                <label for="location-0">ƒê·ªãa ƒëi·ªÉm:</label>
                                <select id="location-0" class="location" required>
                                    <option value="">-- Ch·ªçn ƒë·ªãa ƒëi·ªÉm --</option>
                                    <option value="H√≤a Kh√°nh Nam">H√≤a Kh√°nh Nam</option>
                                    <option value="209 Phan Thanh">209 Phan Thanh</option>
                                    <option value="K7/25 Quang Trung">K7/25 Quang Trung</option>
                                    <option value="254 Nguy·ªÖn VƒÉn Linh">254 Nguy·ªÖn VƒÉn Linh</option>
                                    <option value="78A Phan VƒÉn Tr·ªã">78A Phan VƒÉn Tr·ªã</option>
                                    <option value="137 Nguy·ªÖn VƒÉn Linh">137 Nguy·ªÖn VƒÉn Linh</option>
                                    <option value="03 Quang Trung">03 Quang Trung</option>
                                </select>
                            </div>
                            <button type="button" class="remove-session-btn" style="display:none;">X√≥a</button>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="add-session-btn">Th√™m gi·ªù h·ªçc</button>
                    <button type="submit" class="add-course-btn">Th√™m M√¥n H·ªçc</button>
                </div>

            </form>
        </div>

        <div id="page2" class="page" style="display:none;">
            <h2>Th·ªùi Kh√≥a Bi·ªÉu</h2>
            <div class="timetable-switch-buttons">
                <button class="timetable-button active" onclick="showTimetable('1')">Giai ƒëo·∫°n 1</button>
                <button class="timetable-button" onclick="showTimetable('2')">Giai ƒëo·∫°n 2</button>
            </div>

            <div class="timetable-display" id="timetable-gd1">
                <table id="table-gd1">
                    <thead>
                        <tr>
                            <th>Gi·ªù</th>
                            <th>T2</th>
                            <th>T3</th>
                            <th>T4</th>
                            <th>T5</th>
                            <th>T6</th>
                            <th>T7</th>
                            <th>CN</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

            <div class="timetable-display" id="timetable-gd2" style="display:none;">
                <table id="table-gd2">
                    <thead>
                        <tr>
                            <th>Gi·ªù</th>
                            <th>T2</th>
                            <th>T3</th>
                            <th>T4</th>
                            <th>T5</th>
                            <th>T6</th>
                            <th>T7</th>
                            <th>CN</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="page3" class="page" style="display:none;">
            <h2>M√¥n H·ªçc ƒê√£ ƒêƒÉng K√Ω</h2>
            <div class="course-summary">
                <p>T·ªïng s·ªë t√≠n ch·ªâ ƒë√£ ƒëƒÉng k√Ω: <strong id="total-credits">0</strong></p>
            </div>
            <div class="course-list">
                <table>
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>T√™n m√¥n h·ªçc</th>
                            <th>M√£ l·ªõp</th>
                            <th>M√£ ƒêK</th>
                            <th>Gƒê</th>
                            <th>TC</th>
                            <th>Gi·∫£ng vi√™n</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="registered-courses-body">
                    </tbody>
                </table>
            </div>
        </div>

        <div id="page4" class="page" style="display:none;">
            <h2>Qu·∫£n l√Ω H·ªçc Ph√≠ v√† D·ªØ li·ªáu</h2>
            <p>
                <label for="fee-per-credit">H·ªçc ph√≠ (16 t√≠n ch·ªâ):</label>
                <input type="text" id="fee-per-credit" placeholder="Nh·∫≠p h·ªçc ph√≠ 16 t√≠n ch·ªâ"
                    oninput="calculateTuitionFee()">
            </p>
            <p><strong>Ch·ªçn ch∆∞∆°ng tr√¨nh:</strong></p>
            <div class="checkbox-group">
                <label><input type="radio" name="program-type" value="normal" checked onchange="calculateTuitionFee()">
                    Ch∆∞∆°ng tr√¨nh th√¥ng th∆∞·ªùng</label>
                <label><input type="radio" name="program-type" value="advanced" onchange="calculateTuitionFee()"> Ch∆∞∆°ng
                    tr√¨nh Ti√™n ti·∫øn qu·ªëc t·∫ø</label>
            </div>
            <p><strong>T·ªïng h·ªçc ph√≠ t·∫°m t√≠nh:</strong> <span id="total-tuition-fee">0 VNƒê</span></p>
            <div class="file-actions">
                <button type="button" class="file-action-btn clear-all-btn" onclick="clearAllCourses()">X√≥a t·∫•t c·∫£
                    m√¥n</button>
                <button type="button" class="file-action-btn export-btn" onclick="exportData()">Xu·∫•t File</button>
                <button type="button" class="file-action-btn import-btn" onclick="redirectToPage()">Gi·∫£i m√£
                    JSON</button>
                <label class="file-action-btn import-btn custom-file-upload">
                    <input type="file" id="import-file-page4" accept=".json" onchange="loadData(event)" />
                    T·∫£i File
                </label>


            </div>
        </div>
    </div>

    <div id="custom-alert" class="alert-container">
        <div class="alert-box">
            <span id="alert-icon" class="alert-icon"></span>
            <span id="alert-title" class="alert-title"></span>
            <div id="alert-message"></div>
            <button id="alert-ok-btn">OK</button>
        </div>
    </div>
    <script>
        // Function ƒë·ªÉ v√¥ hi·ªáu h√≥a F12 v√† c√°c ph√≠m t·∫Øt kh√°c c·ªßa DevTools
        function disableDevTools() {
            document.addEventListener('keydown', (e) => {
                if (
                    e.key === 'F12' ||
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
                    (e.ctrlKey && e.key === 'U')
                ) {
                    e.preventDefault();
                    console.log('Developer Tools are disabled.');
                }
            });
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
            });
            const threshold = 160;
            let devToolsOpen = false;
            window.addEventListener('resize', () => {
                if (
                    window.outerWidth - window.innerWidth > threshold ||
                    window.outerHeight - window.innerHeight > threshold
                ) {
                    if (!devToolsOpen) {
                        devToolsOpen = true;
                        console.log('DevTools have been detected and an action has been taken.');
                    }
                } else {
                    devToolsOpen = false;
                }
            });
        }
        disableDevTools();

        // C·∫¨P NH·∫¨T H√ÄM showAlert (4 tham s·ªë)
        function showAlert(title, message, type, details = '') {
            const alertContainer = document.getElementById('custom-alert');
            const alertBox = alertContainer.querySelector('.alert-box');
            const alertIcon = document.getElementById('alert-icon');
            const alertTitle = document.getElementById('alert-title');
            const alertMessage = document.getElementById('alert-message');
            const alertOkBtn = document.getElementById('alert-ok-btn');

            alertTitle.textContent = title;

            // N·∫øu l√† l·ªói tr√πng l·ªãch, message l√† ƒëo·∫°n vƒÉn b·∫£n ƒë·∫ßu ti√™n
            if (type === 'error' && details) {
                alertMessage.innerHTML = `<p>${message}</p><div class="conflict-detail">${details}</div>`;
            } else {
                // ƒê·ªëi v·ªõi th√¥ng b√°o th√¥ng th∆∞·ªùng (success/l·ªói kh√°c)
                alertMessage.innerHTML = `<p style="text-align:center; font-weight:bold;">${message}</p>`;
            }


            alertBox.className = `alert-box ${type}`;
            alertIcon.className = `alert-icon ${type}`;
            alertContainer.style.display = 'flex';

            alertOkBtn.onclick = function () {
                alertContainer.style.display = 'none';
            };
        }

        // Chuy·ªÉn ƒë·ªïi gi·ªØa c√°c trang
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById(pageId).style.display = 'block';

            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`button[onclick="showPage('${pageId}')"]`).classList.add('active');

            if (pageId === 'page2') {
                renderTimetable();
                showTimetable('1');
            }
            if (pageId === 'page3') {
                updateRegisteredCoursesList();
            }
            if (pageId === 'page4') {
                calculateTuitionFee();
            }
        }

        // Chuy·ªÉn ƒë·ªïi gi·ªØa c√°c th·ªùi kh√≥a bi·ªÉu Giai ƒëo·∫°n 1 v√† 2
        function showTimetable(semester) {
            document.getElementById('timetable-gd1').style.display = 'none';
            document.getElementById('timetable-gd2').style.display = 'none';
            document.getElementById(`timetable-gd${semester}`).style.display = 'block';

            document.querySelectorAll('.timetable-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`button[onclick="showTimetable('${semester}')"]`).classList.add('active');
        }

        // Global data and state variables
        let registeredCourses = [];
        let tuitionFeeData = {
            feePer16Credits: 0,
            programType: 'normal'
        };
        let sessionCounter = 1;

        // T√¨m ƒë·∫øn ƒëo·∫°n m√£ x·ª≠ l√Ω s·ª± ki·ªán click c·ªßa n√∫t "Th√™m gi·ªù h·ªçc"
        document.querySelector('.add-session-btn').addEventListener('click', () => {
            const container = document.getElementById('class-sessions-container');
            const newSession = document.createElement('div');
            newSession.className = 'class-session-row';
            newSession.innerHTML = `
        <div class="input-row">
            <div class="input-group">
                <label for="day-of-week-${sessionCounter}">Th·ª©:</label>
                <select id="day-of-week-${sessionCounter}" class="day-of-week" required>
                    <option value="">-- Ch·ªçn --</option>
                    <option value="T2">T2</option>
                    <option value="T3">T3</option>
                    <option value="T4">T4</option>
                    <option value="T5">T5</option>
                    <option value="T6">T6</option>
                    <option value="T7">T7</option>
                    <option value="CN">CN</option>
                </select>
            </div>
            <div class="input-group">
                <label for="time-${sessionCounter}">Gi·ªù h·ªçc:</label>
                <select id="time-${sessionCounter}" class="time" required>
                    <option value="">-- Ch·ªçn --</option>
                    <option value="07:00-09:00">07:00 - 09:00</option>
                    <option value="07:00-10:15">07:00 - 10:15</option>
                    <option value="07:00-11:15">07:00 - 11:15</option>
                    <option value="09:15-11:15">09:15 - 11:15</option>
                    <option value="13:00-15:00">13:00 - 15:00</option>
                    <option value="13:00-16:15">13:00 - 16:15</option>
                    <option value="13:00-17:15">13:00 - 17:15</option>
                    <option value="15:15-17:15">15:15 - 17:15</option>
                    <option value="17:45-21:00">17:45 - 21:00</option>
                </select>
            </div>
        </div>
        <div class="input-row">
            <label for="location-type-${sessionCounter}">Lo·∫°i ƒë·ªãa ƒëi·ªÉm:</label>
            <select id="location-type-${sessionCounter}" class="location-type" required>
                <option value="">-- Ch·ªçn --</option>
                <option value="online">Online</option>
                <option value="campus">C∆° s·ªü</option>
            </select>
<div class="campus-location-field" style="display:none;">
    <label for="location-${sessionCounter}">ƒê·ªãa ƒëi·ªÉm:</label>
    <select id="location-${sessionCounter}" class="location" required>
        <option value="">-- Ch·ªçn ƒë·ªãa ƒëi·ªÉm --</option>
        <option value="H√≤a Kh√°nh Nam">H√≤a Kh√°nh Nam</option>
        <option value="209 Phan Thanh">209 Phan Thanh</option>
        <option value="K7/25 Quang Trung">K7/25 Quang Trung</option>
        <option value="254 Nguy·ªÖn VƒÉn Linh">254 Nguy·ªÖn VƒÉn Linh</option>
        <option value="78A Phan VƒÉn Tr·ªã">78A Phan VƒÉn Tr·ªã</option>
        <option value="137 Nguy·ªÖn VƒÉn Linh">137 Nguy·ªÖn VƒÉn Linh</option>
        <option value="03 Quang Trung">03 Quang Trung</option>
    </select>
               </div>
            <button type="button" class="remove-session-btn">X√≥a</button>
        </div>
    `;
            container.appendChild(newSession);

            // Attach event listeners to the new elements
            newSession.querySelector('.location-type').addEventListener('change', handleLocationTypeChange);
            newSession.querySelector('.remove-session-btn').addEventListener('click', removeSession);

            // Ensure the first "X√≥a" button is shown if there's more than one session
            document.querySelector('.class-session-row .remove-session-btn').style.display = 'inline-block';

            sessionCounter++;
        });

        // X√≥a m·ªôt kh·ªëi nh·∫≠p li·ªáu gi·ªù h·ªçc
        function removeSession(e) {
            const sessionRow = e.target.closest('.class-session-row');
            if (document.querySelectorAll('.class-session-row').length > 1) {
                sessionRow.remove();
            }
            // ·∫®n n√∫t "X√≥a" n·∫øu ch·ªâ c√≤n m·ªôt kh·ªëi
            if (document.querySelectorAll('.class-session-row').length === 1) {
                document.querySelector('.class-session-row .remove-session-btn').style.display = 'none';
            }
        }

        // X·ª≠ l√Ω logic hi·ªÉn th·ªã tr∆∞·ªùng ƒë·ªãa ƒëi·ªÉm
        function handleLocationTypeChange(event) {
            const sessionRow = event.target.closest('.class-session-row');
            const campusField = sessionRow.querySelector('.campus-location-field');
            const locationInput = sessionRow.querySelector('.location');
            if (event.target.value === 'campus') {
                campusField.style.display = 'flex';
                locationInput.required = true;
            } else {
                campusField.style.display = 'none';
                locationInput.required = false;
            }
        }
        document.querySelectorAll('.location-type').forEach(select => {
            select.addEventListener('change', handleLocationTypeChange);
        });
        document.querySelectorAll('.remove-session-btn').forEach(btn => {
            btn.addEventListener('click', removeSession);
        });

        // Chu·∫©n h√≥a gi√° tr·ªã "Giai ƒëo·∫°n"
        function normalizeSemesterWeek(value) {
            const v = value.trim();
            if (v === '1' || v.toLowerCase() === 'giai ƒëo·∫°n 1') return 'Giai ƒëo·∫°n 1';
            if (v === '2' || v.toLowerCase() === 'giai ƒëo·∫°n 2') return 'Giai ƒëo·∫°n 2';
            if (
                v === 'C·∫£ 2 giai ƒëo·∫°n' ||
                v === '1,2' ||
                v === '2,1' ||
                v.toLowerCase() === 'c·∫£ 2 giai ƒëo·∫°n'
            ) return 'C·∫£ 2 giai ƒëo·∫°n';
            return v;
        }

        // Chuy·ªÉn ƒë·ªïi th·ªùi gian d·∫°ng "HH:mm" th√†nh ph√∫t
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // Chuy·ªÉn ƒë·ªïi nh√£n giai ƒëo·∫°n th√†nh m√£ giai ƒëo·∫°n
        function getSemestersFromLabel(label) {
            if (label === 'Giai ƒëo·∫°n 1') {
                return ['1'];
            } else if (label === 'Giai ƒëo·∫°n 2') {
                return ['2'];
            } else if (label === 'C·∫£ 2 giai ƒëo·∫°n') {
                return ['1', '2'];
            }
            return [];
        }

        // Render l·∫°i to√†n b·ªô th·ªùi kh√≥a bi·ªÉu
        function renderTimetable() {
            const tables = {
                '1': document.getElementById('table-gd1').querySelector('tbody'),
                '2': document.getElementById('table-gd2').querySelector('tbody')
            };
            tables['1'].innerHTML = '';
            tables['2'].innerHTML = '';

            const daysOfWeek = ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'];
            const timeSlots = [
                "07:00", "08:00", "09:00", "10:00", "11:00", "12:00",
                "13:00", "14:00", "15:00", "16:00", "17:00", "18:00",
                "19:00", "20:00", "21:00"
            ];

            for (const semester of ['1', '2']) {
                const occupiedCells = new Set();

                // T·∫°o m·ªôt m·∫£ng flat ch·ª©a t·∫•t c·∫£ c√°c bu·ªïi h·ªçc (sessions)
                const allSessions = registeredCourses.flatMap(course =>
                    course.sessions.map(session => ({
                        ...session,
                        semesterWeek: course.semesterWeek,
                        classCode: course.classCode
                    }))
                ).filter(session => getSemestersFromLabel(session.semesterWeek).includes(semester));

                for (let i = 0; i < timeSlots.length; i++) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td class="time-label">${timeSlots[i]}</td>`;

                    for (let j = 0; j < daysOfWeek.length; j++) {
                        const day = daysOfWeek[j];
                        const cellKey = `${timeSlots[i]}-${day}`;

                        if (occupiedCells.has(cellKey)) {
                            continue;
                        }

                        const session = allSessions.find(s => {
                            const sessionStartHour = s.time.split('-')[0];
                            return s.dayOfWeek === day && sessionStartHour.substring(0, 2) === timeSlots[i].substring(0, 2);
                        });

                        if (session) {
                            const [startTime, endTime] = session.time.split('-');
                            const startMin = timeToMinutes(startTime);
                            const endMin = timeToMinutes(endTime);
                            const durationInHours = (endMin - startMin) / 60;
                            const rowspan = Math.ceil(durationInHours);

                            for (let k = 0; k < rowspan; k++) {
                                if (i + k < timeSlots.length) {
                                    occupiedCells.add(`${timeSlots[i + k]}-${day}`);
                                }
                            }

                            const location = session.locationType === 'online' ? 'Online' : session.location;
                            row.innerHTML += `
                        <td rowspan="${rowspan}" class="${session.locationType}-class">
                            <strong>${session.classCode}</strong><br/>
                            ${location}<br/>
                            (${session.time})
                        </td>
                    `;
                        } else {
                            row.innerHTML += `<td></td>`;
                        }
                    }
                    tables[semester].appendChild(row);
                }
            }
        }

        // X·ª≠ l√Ω form khi submit
        document.getElementById('course-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const semesterWeekRaw = document.getElementById('semester-week').value;
            const semesterWeek = normalizeSemesterWeek(semesterWeekRaw);

            if (!['Giai ƒëo·∫°n 1', 'Giai ƒëo·∫°n 2', 'C·∫£ 2 giai ƒëo·∫°n'].includes(semesterWeek)) {
                showAlert('L·ªñI D·ªÆ LI·ªÜU', 'Vui l√≤ng ch·ªçn ƒë√∫ng gi√° tr·ªã cho tr∆∞·ªùng "Tu·∫ßn h·ªçc".', 'error');
                return;
            }

            const sessions = [];
            let isConflict = false;

            // L·∫•y d·ªØ li·ªáu t·ª´ t·∫•t c·∫£ c√°c kh·ªëi gi·ªù h·ªçc
            const sessionElements = document.querySelectorAll('.class-session-row');
            sessionElements.forEach(sessionElement => {
                const dayOfWeek = sessionElement.querySelector('.day-of-week').value.toUpperCase();
                const time = sessionElement.querySelector('.time').value;
                const locationType = sessionElement.querySelector('.location-type').value;
                const location = (locationType === 'online') ? 'Online' : sessionElement.querySelector('.location').value;

                // Ki·ªÉm tra d·ªØ li·ªáu bu·ªïi h·ªçc
                if (!dayOfWeek || !time || !locationType) {
                    isConflict = true;
                    showAlert('L·ªñI D·ªÆ LI·ªÜU', 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin cho t·∫•t c·∫£ c√°c bu·ªïi h·ªçc.', 'error');
                    return;
                }

                sessions.push({
                    dayOfWeek,
                    time,
                    locationType,
                    location
                });
            });

            if (isConflict) {
                return;
            }

            const newCourse = {
                id: Date.now(),
                courseName: document.getElementById('course-name').value,
                classCode: document.getElementById('class-code').value,
                regCode: document.getElementById('reg-code').value,
                semesterWeek: semesterWeek,
                lecturer: document.getElementById('lecturer').value,
                credits: parseInt(document.getElementById('credits').value, 10),
                sessions: sessions
            };

            const semesters = getSemestersFromLabel(newCourse.semesterWeek);

            // Ki·ªÉm tra tr√πng l·ªãch v·ªõi c√°c m√¥n ƒë√£ ƒëƒÉng k√Ω
            for (const existingCourse of registeredCourses) {
                const existingSemesters = getSemestersFromLabel(existingCourse.semesterWeek);
                const hasCommonSemester = existingSemesters.some(s => semesters.includes(s));

                if (hasCommonSemester) {
                    for (const newSession of newCourse.sessions) {
                        for (const existingSession of existingCourse.sessions) {
                            if (newSession.dayOfWeek === existingSession.dayOfWeek) {
                                const newStartTimeInMin = timeToMinutes(newSession.time.split('-')[0]);
                                const newEndTimeInMin = timeToMinutes(newSession.time.split('-')[1]);
                                const existingStartTimeInMin = timeToMinutes(existingSession.time.split('-')[0]);
                                const existingEndTimeInMin = timeToMinutes(existingSession.time.split('-')[1]);

                                if (Math.max(newStartTimeInMin, existingStartTimeInMin) < Math.min(newEndTimeInMin, existingEndTimeInMin)) {
                                    isConflict = true;

                                    // C·∫¨P NH·∫¨T C√ÅCH G·ªåI H√ÄM showAlert
                                    const detailsHTML = `M√¥n: <b>${existingCourse.courseName}</b><br>
                                                 Th·ªùi gian: <b>${existingSession.time}</b><br>
                                                 Ng√†y: <b>${existingSession.dayOfWeek}</b>`;

                                    showAlert(
                                        'L·ªäCH H·ªåC B·ªä TR√ôNG!',
                                        'M√¥n b·∫°n ƒëang c·ªë g·∫Øng ƒëƒÉng k√Ω b·ªã tr√πng v·ªõi m√¥n:',
                                        'error',
                                        detailsHTML
                                    );
                                    break;
                                }
                            }
                        }
                        if (isConflict) break;
                    }
                }
                if (isConflict) break;
            }

            if (isConflict) {
                return;
            }

            registeredCourses.push(newCourse);
            registeredCourses.sort((a, b) => timeToMinutes(a.sessions[0].time.split('-')[0]) - timeToMinutes(b.sessions[0].time.split('-')[0]));
            renderTimetable();

            // C·∫¨P NH·∫¨T C√ÅCH G·ªåI H√ÄM showAlert
            showAlert('TH√ÄNH C√îNG', 'ƒêƒÉng k√Ω m√¥n h·ªçc th√†nh c√¥ng!', 'success');

            document.getElementById('course-form').reset();
            // Thay th·∫ø ƒëo·∫°n m√£ c≈© b·∫±ng ƒëo·∫°n HTML sau ƒë·ªÉ form hi·ªÉn th·ªã l·∫°i dropdown
            document.getElementById('class-sessions-container').innerHTML = `
<div class="class-session-row">
    <div class="input-row">
        <div class="input-group">
            <label for="day-of-week-0">Th·ª©:</label>
            <select id="day-of-week-0" class="day-of-week" required>
                <option value="">-- Ch·ªçn --</option>
                <option value="T2">T2</option>
                <option value="T3">T3</option>
                <option value="T4">T4</option>
                <option value="T5">T5</option>
                <option value="T6">T6</option>
                <option value="T7">T7</option>
                <option value="CN">CN</option>
            </select>
        </div>
        <div class="input-group">
            <label for="time-0">Gi·ªù h·ªçc:</label>
            <select id="time-0" class="time" required>
                <option value="">-- Ch·ªçn --</option>
                <option value="07:00-09:00">07:00 - 09:00</option>
                <option value="07:00-10:15">07:00 - 10:15</option>
                <option value="07:00-11:15">07:00 - 11:15</option>
                <option value="09:15-11:15">09:15 - 11:15</option>
                <option value="13:00-15:00">13:00 - 15:00</option>
                <option value="13:00-16:15">13:00 - 16:15</option>
                <option value="13:00-17:15">13:00 - 17:15</option>
                <option value="15:15-17:15">15:15 - 17:15</option>
                <option value="17:45-21:00">17:45 - 21:00</option>
            </select>
        </div>
    </div>
    <div class="input-row">
        <label for="location-type-0">Lo·∫°i ƒë·ªãa ƒëi·ªÉm:</label>
        <select id="location-type-0" class="location-type" required>
            <option value="">-- Ch·ªçn --</option>
            <option value="online">Online</option>
            <option value="campus">C∆° s·ªü</option>
        </select>
        <div class="campus-location-field" style="display:none;">
            <label for="location-0">ƒê·ªãa ƒëi·ªÉm:</label>
            <select id="location-0" class="location" required>
                <option value="">-- Ch·ªçn ƒë·ªãa ƒëi·ªÉm --</option>
                <option value="H√≤a Kh√°nh Nam">H√≤a Kh√°nh Nam</option>
                <option value="209 Phan Thanh">209 Phan Thanh</option>
                <option value="K7/25 Quang Trung">K7/25 Quang Trung</option>
                <option value="254 Nguy·ªÖn VƒÉn Linh">254 Nguy·ªÖn VƒÉn Linh</option>
                <option value="78A Phan VƒÉn Tr·ªã">78A Phan VƒÉn Tr·ªã</option>
                <option value="137 Nguy·ªÖn VƒÉn Linh">137 Nguy·ªÖn VƒÉn Linh</option>
                <option value="03 Quang Trung">03 Quang Trung</option>
            </select>
        </div>
        <button type="button" class="remove-session-btn" style="display:none;">X√≥a</button>
    </div>
</div>
`;
            sessionCounter = 1;
            document.querySelector('.class-session-row .location-type').addEventListener('change', handleLocationTypeChange);
            document.querySelector('.class-session-row .remove-session-btn').addEventListener('click', removeSession);
        });

        // C·∫≠p nh·∫≠t danh s√°ch m√¥n ƒë√£ ƒëƒÉng k√Ω v√† t·ªïng t√≠n ch·ªâ
        function updateRegisteredCoursesList() {
            const tbody = document.getElementById('registered-courses-body');
            tbody.innerHTML = '';
            let totalCredits = 0;

            registeredCourses.forEach((course, index) => {
                const row = tbody.insertRow();
                const semesterLabel = course.semesterWeek;
                row.innerHTML = `
            <td>${index + 1}</td>
            <td>${course.courseName}</td>
            <td>${course.classCode}</td>
            <td>${course.regCode}</td>
            <td>${semesterLabel}</td>
            <td>${course.credits}</td>
            <td>${course.lecturer}</td>
            <td><button class="remove-btn" onclick="removeCourse(${course.id})">X√≥a</button></td>
        `;
                totalCredits += parseInt(course.credits, 10);
            });

            document.getElementById('total-credits').textContent = totalCredits;
            calculateTuitionFee();
        }

        // X√≥a m√¥n h·ªçc
        function removeCourse(courseId) {
            registeredCourses = registeredCourses.filter(c => c.id !== courseId);
            renderTimetable();
            updateRegisteredCoursesList();
        }

        // X√≥a t·∫•t c·∫£ m√¥n h·ªçc
        function clearAllCourses() {
            registeredCourses = [];
            renderTimetable();
            updateRegisteredCoursesList();

            // C·∫¨P NH·∫¨T C√ÅCH G·ªåI H√ÄM showAlert
            showAlert('TH√ÄNH C√îNG', 'ƒê√£ x√≥a t·∫•t c·∫£ m√¥n h·ªçc.', 'success');
        }

        // T√≠nh to√°n h·ªçc ph√≠
        function calculateTuitionFee() {
            const totalCredits = parseInt(document.getElementById('total-credits').textContent);
            const feePer16Credits = parseFloat(document.getElementById('fee-per-credit').value.replace(/[^0-9]/g, '')) || 0;
            const programType = document.querySelector('input[name="program-type"]:checked').value;
            let tuitionFee = 0;

            // L∆∞u gi√° tr·ªã v√†o bi·∫øn to√†n c·ª•c
            tuitionFeeData.feePer16Credits = feePer16Credits;
            tuitionFeeData.programType = programType;

            if (feePer16Credits === 0) {
                document.getElementById('total-tuition-fee').textContent = 'Vui l√≤ng nh·∫≠p h·ªçc ph√≠';
                return;
            }

            const feePerCredit = feePer16Credits / 16;
            let baseFee = feePer16Credits;

            if (programType === 'normal') {
                if (totalCredits < 14) {
                    tuitionFee = totalCredits * feePerCredit;
                } else if (totalCredits >= 14 && totalCredits <= 19) {
                    tuitionFee = baseFee;
                } else if (totalCredits > 19) {
                    const extraCredits = totalCredits - 19;
                    tuitionFee = baseFee + (extraCredits * feePerCredit);
                }
            } else if (programType === 'advanced') {
                if (totalCredits < 14) {
                    tuitionFee = totalCredits * feePerCredit;
                } else if (totalCredits >= 14 && totalCredits <= 21) {
                    tuitionFee = baseFee;
                } else if (totalCredits > 21) {
                    const extraCredits = totalCredits - 21;
                    tuitionFee = baseFee + (extraCredits * feePerCredit);
                }
            }

            const formattedFee = tuitionFee.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
            document.getElementById('total-tuition-fee').textContent = formattedFee;
        }

        // H√†m xu·∫•t d·ªØ li·ªáu ra file JSON
        function exportData() {
            if (registeredCourses.length === 0) {
                showAlert('L·ªñI XU·∫§T FILE', 'Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t.', 'error');
                return;
            }
            const dataToExport = {
                courses: registeredCourses,
                tuitionFeeData: tuitionFeeData
            };
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'thoi-khoa-bieu.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // C·∫¨P NH·∫¨T C√ÅCH G·ªåI H√ÄM showAlert
            showAlert('TH√ÄNH C√îNG', 'Xu·∫•t file th√†nh c√¥ng!', 'success');
        }

        // H√†m t·∫£i d·ªØ li·ªáu t·ª´ file JSON
        function loadData(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const loadedData = JSON.parse(e.target.result);
                    if (!loadedData.courses || !Array.isArray(loadedData.courses)) {
                        throw new Error('ƒê·ªãnh d·∫°ng file kh√¥ng h·ª£p l·ªá.');
                    }
                    registeredCourses = loadedData.courses;
                    tuitionFeeData = loadedData.tuitionFeeData || { feePer16Credits: 0, programType: 'normal' };

                    // C·∫≠p nh·∫≠t giao di·ªán t·ª´ d·ªØ li·ªáu ƒë√£ t·∫£i
                    if (tuitionFeeData.feePer16Credits) {
                        document.getElementById('fee-per-credit').value = tuitionFeeData.feePer16Credits.toLocaleString('vi-VN');
                    }
                    document.querySelector(`input[name="program-type"][value="${tuitionFeeData.programType}"]`).checked = true;

                    renderTimetable();
                    updateRegisteredCoursesList();

                    // C·∫¨P NH·∫¨T C√ÅCH G·ªåI H√ÄM showAlert
                    showAlert('TH√ÄNH C√îNG', 'T·∫£i d·ªØ li·ªáu th√†nh c√¥ng!', 'success');
                } catch (error) {
                    console.error('L·ªói khi t·∫£i file:', error);
                    showAlert('L·ªñI D·ªÆ LI·ªÜU', 'ƒê·ªãnh d·∫°ng file kh√¥ng h·ª£p l·ªá. Vui l√≤ng t·∫£i file JSON ƒë√∫ng ƒë·ªãnh d·∫°ng.', 'error');
                }
            };
            reader.onerror = function () {
                showAlert('L·ªñI ƒê·ªåC FILE', 'L·ªói khi ƒë·ªçc file. Vui l√≤ng th·ª≠ l·∫°i.', 'error');
            };
            reader.readAsText(file);
        }

        // Th√™m s·ª± ki·ªán ƒë·ªÉ format gi√° tr·ªã khi nh·∫≠p
        document.getElementById('fee-per-credit').addEventListener('input', function (e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            e.target.value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            calculateTuitionFee();
        });

        function redirectToPage() {
            window.location.href = "chuyendoijson.html";
        }
    </script>>
</body>

</html>