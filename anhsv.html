<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>T√¨m ·∫£nh sinh vi√™n ‚Äî Duy T√¢n</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    /* Reset nh·ªè */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background: linear-gradient(135deg, #afd2f4, #c1f1b6);
      padding: 20px;
      color: #222;
    }

    /* Container ch√≠nh */
    .main-container {
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 1100px;
    }

    /* Ti√™u ƒë·ªÅ */
    h1,
    h2 {
      text-align: center;
      color: #f55454;
    }

    /* Form */
    #search-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    #student-ids {
      width: 100%;
      min-height: 120px;
      border: 1px solid #c6dff5;
      border-radius: 10px;
      padding: 12px;
      font-size: 0.95rem;
      resize: vertical;
      transition: all 0.2s ease;
    }

    #student-ids:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
    }

    /* Row */
    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    #upload-file {
      flex: 1;
    }

    /* Buttons */
    button {
      border: none;
      cursor: pointer;
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      transition: 0.2s ease;
    }

    #search-btn {
      background: #007bff;
      color: #fff;
      align-self: center;
      margin-top: 0.5rem;
    }

    #search-btn:hover {
      background: #0056b3;
    }

    .input-buttons {
      display: flex;
      gap: 8px;
    }

    .input-buttons button {
      background: #f1f7ff;
      color: #007bff;
      border: 1px solid #c6dff5;
    }

    .input-buttons button:hover {
      background: #007bff;
      color: #fff;
    }

    #back-button {
      background: #6c757d;
      color: #fff;
    }

    #back-button:hover {
      background: #ff4d4d;
    }

    /* Info text */
    .info {
      font-size: 0.85rem;
      color: #0a3a66;
    }

    /* Image view */
    #image-view {
      display: none;
      margin-top: 1rem;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      margin-bottom: 1rem;

      position: sticky;
      /* c·ªë ƒë·ªãnh */
      top: 0;
      /* d√≠nh v√†o tr√™n */
      background: #fff;
      /* n·ªÅn tr·∫Øng ƒë·ªÉ che ·∫£nh khi cu·ªôn */
      padding: 10px;
      border-bottom: 1px solid #e3edf7;
      z-index: 10;
      /* n·ªïi tr√™n ·∫£nh */
    }

    #search-in-images {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #c6dff5;
      border-radius: 6px;
    }

    .summary {
      font-size: 0.9rem;
      color: #07385b;
    }

    /* Grid ·∫£nh */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
    }

    .student-card {
      background: #f9fcff;
      border: 1px solid #e3edf7;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      transition: transform 0.2s ease;
    }

    .student-card:hover {
      transform: translateY(-4px);
    }

    .student-card img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
    }

    .placeholder {
      width: 100%;
      aspect-ratio: 3/4;
      border-radius: 8px;
      background: #eaf5ff;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #007bff;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .caption {
      font-size: 0.9rem;
      font-weight: 600;
      color: #0a3a66;
      text-align: center;
    }
  </style>

</head>

<body>
  <div class="main-container">
    <div id="search-form-container">
      <h1>T√¨m ·∫£nh sinh vi√™n</h1>
      <h2>ƒê·∫†I H·ªåC DUY T√ÇN</h2>

      <form id="search-form">
        <textarea id="student-ids" placeholder="Nh·∫≠p nhi·ªÅu MSSV (m·ªói MSSV tr√™n 1 d√≤ng ho·∫∑c c√°ch nhau b·ªüi d·∫•u ph·∫©y)"
          autocomplete="off"></textarea>
        <div class="row">
          <input type="file" id="upload-file" accept=".txt,.csv,.xlsx,.xls" />
        </div>

        <div class="row input-buttons">
          <button type="button" id="paste-button">üìã D√°n</button>
          <button type="button" id="clear-button">üóë X√≥a</button>
        </div>
        <button type="submit" id="search-btn">üîç T√¨m ki·∫øm</button>
        <div id="info" class="info"></div>
      </form>
    </div>

    <div id="image-view">
      <div class="topbar">
        <button id="back-button">Quay l·∫°i</button>
        <input type="text" id="search-in-images" placeholder="T√¨m MSSV trong danh s√°ch..." />
        <div id="summary" class="summary"></div>
      </div>

      <div id="student-images" class="grid"></div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    document.addEventListener('contextmenu', function (e) {
      e.preventDefault();
    });

    document.addEventListener('keydown', function (e) {
      if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C'))) {
        e.preventDefault();
        Swal.fire({
          icon: "error",
          title: "B·ªã ch·∫∑n!",
          text: "Truy c·∫≠p c√¥ng c·ª• nh√† ph√°t tri·ªÉn ƒë√£ b·ªã ch·∫∑n."
        });
      }
      if (e.ctrlKey && e.key === 'U') {
        e.preventDefault();
        Swal.fire({
          icon: "warning",
          title: "Kh√¥ng cho ph√©p!",
          text: "Xem m√£ ngu·ªìn ƒë√£ b·ªã ch·∫∑n."
        });
      }
    });

    // T√°ch MSSV t·ª´ text (8-15 s·ªë)
    function extractIdsFromText(text) {
      if (!text) return [];
      const matches = text.match(/\d{8,15}/g) || [];
      const filtered = matches.filter(m => !/^0+$/.test(m));
      return Array.from(new Set(filtered));
    }

    // T·∫°o card ·∫£nh
    function createCard(id) {
      const card = document.createElement("div");
      card.className = "student-card";

      const img = document.createElement("img");
      img.loading = "lazy";
      img.alt = `·∫¢nh ${id}`;
      img.src = `https://hfs1.duytan.edu.vn/Upload/dichvu/sv_${id}_01.jpg`;

      img.onerror = () => {
        img.remove();
        const ph = document.createElement("div");
        ph.className = "placeholder";
        ph.textContent = id;
        card.prepend(ph);
      };

      const caption = document.createElement("div");
      caption.className = "caption";
      caption.textContent = id;

      card.appendChild(img);
      card.appendChild(caption);
      return card;
    }

    // Hi·ªÉn th·ªã ·∫£nh
    function searchStudentImages(ids) {
      const container = document.getElementById("student-images");
      container.innerHTML = "";

      if (ids.length === 0) {
        Swal.fire({
          icon: "error",
          title: "Kh√¥ng t√¨m th·∫•y!",
          text: "B·∫°n ch∆∞a nh·∫≠p MSSV h·ª£p l·ªá."
        });
        return;
      }

      const used = ids.slice(0, 800);
      used.forEach(id => container.appendChild(createCard(id)));

      document.getElementById("search-form-container").style.display = "none";
      document.getElementById("image-view").style.display = "block";

      document.getElementById("summary").textContent =
        `T√¨m: ${ids.length} M√£ Sinh vi√™n (hi·ªÉn th·ªã ${used.length})`;
    }

    // Form submit
    document.getElementById("search-form").addEventListener("submit", e => {
      e.preventDefault();
      const ids = extractIdsFromText(document.getElementById("student-ids").value);
      if (ids.length > 0) searchStudentImages(ids);
      else {
        Swal.fire({
          icon: "warning",
          title: "Thi·∫øu d·ªØ li·ªáu!",
          text: "H√£y nh·∫≠p ho·∫∑c d√°n MSSV tr∆∞·ªõc khi t√¨m ki·∫øm."
        });
      }
    });

    // Upload file
    document.getElementById("upload-file").addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;

      if (file.name.endsWith(".xlsx") || file.name.endsWith(".xls")) {
        const reader = new FileReader();
        reader.onload = ev => {
          const data = new Uint8Array(ev.target.result);
          const wb = XLSX.read(data, { type: "array" });
          const sheet = wb.Sheets[wb.SheetNames[0]];
          const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          const content = rows.flat().join("\n");
          const ids = extractIdsFromText(content);
          if (ids.length > 0) {
            document.getElementById("student-ids").value = ids.join("\n");
            Swal.fire({
              icon: "success",
              title: "T·∫£i th√†nh c√¥ng!",
              text: `ƒê√£ t√¨m th·∫•y ${ids.length} MSSV trong file Excel.`,
              timer: 2000,
              showConfirmButton: false
            });
            searchStudentImages(ids);
          } else {
            Swal.fire({
              icon: "error",
              title: "L·ªói!",
              text: "Kh√¥ng t√¨m th·∫•y MSSV trong file Excel!"
            });
          }
        };
        reader.readAsArrayBuffer(file);
      } else {
        const reader = new FileReader();
        reader.onload = ev => {
          const ids = extractIdsFromText(ev.target.result);
          if (ids.length > 0) {
            document.getElementById("student-ids").value = ids.join("\n");
            Swal.fire({
              icon: "success",
              title: "T·∫£i th√†nh c√¥ng!",
              text: `ƒê√£ t√¨m th·∫•y ${ids.length} MSSV trong file.`,
              timer: 2000,
              showConfirmButton: false
            });
            searchStudentImages(ids);
          } else {
            Swal.fire({
              icon: "error",
              title: "L·ªói!",
              text: "File kh√¥ng c√≥ MSSV h·ª£p l·ªá!"
            });
          }
        };
        reader.readAsText(file);
      }
    });

    // Paste
    document.getElementById("paste-button").addEventListener("click", async () => {
      try {
        const text = await navigator.clipboard.readText();
        const ids = extractIdsFromText(text);
        document.getElementById("student-ids").value = ids.join("\n") || text;
        Swal.fire({
          icon: "info",
          title: "D√°n th√†nh c√¥ng",
          text: `ƒê√£ d√°n ${ids.length} MSSV v√†o √¥ nh·∫≠p.`,
          timer: 1500,
          showConfirmButton: false
        });
      } catch {
        Swal.fire({
          icon: "error",
          title: "Kh√¥ng th·ªÉ d√°n!",
          text: "H√£y cho ph√©p quy·ªÅn truy c·∫≠p clipboard."
        });
      }
    });

    // Clear
    document.getElementById("clear-button").addEventListener("click", () => {
      document.getElementById("student-ids").value = "";
      document.getElementById("upload-file").value = "";
      Swal.fire({
        icon: "success",
        title: "ƒê√£ x√≥a!",
        text: "ƒê√£ x√≥a d·ªØ li·ªáu v√† file t·∫£i l√™n.",
        timer: 1200,
        showConfirmButton: false
      });
    });

    // Back
    document.getElementById("back-button").addEventListener("click", () => {
      document.getElementById("search-form-container").style.display = "block";
      document.getElementById("image-view").style.display = "none";
    });

    // Search trong grid
    document.getElementById("search-in-images").addEventListener("input", e => {
      const kw = e.target.value.trim();
      document.querySelectorAll(".student-card").forEach(card => {
        const id = card.querySelector(".caption").textContent;
        card.style.display = id.includes(kw) ? "flex" : "none";
      });
    });

  </script>>
</body>

</html>