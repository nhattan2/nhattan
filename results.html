<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Káº¿t quáº£ sá»©c khá»e</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&family=Roboto:wght@400;500&display=swap"
    rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Font riÃªng cho trang káº¿t quáº£ */
    h1,
    h3 {
      font-family: 'Quicksand', sans-serif;
    }
  </style>
</head>

<body
  class="bg-gradient-to-br from-pink-100 to-purple-100 text-gray-800 font-sans min-h-screen flex flex-col justify-between">

  <div class="container mx-auto p-6 flex-grow animate-fade-in">
    <header class="text-center mb-8">
      <h1 class="text-3xl sm:text-4xl font-bold text-fuchsia-800">
        ChÃ o <span id="userName" class="text-pink-600">báº¡n</span>! ğŸŒ¸
      </h1>
      <p class="text-fuchsia-600 mt-2 text-lg italic">
        MÃ¬nh Ä‘Ã£ láº¯ng nghe vÃ  cÃ³ vÃ i lá»i khuyÃªn cho báº¡n Ä‘Ã¢y.
      </p>
    </header>

    <div class="message-box mt-6 bg-white/90 backdrop-blur-sm shadow-xl">
      <h3 class="text-2xl font-semibold text-fuchsia-800 mb-6 flex items-center">
        <i class="fas fa-heart icon mr-3 text-pink-500 animate-pulse"></i>Lá»i khuyÃªn dÃ nh riÃªng báº¡n
      </h3>
      <div id="adviceContent"
        class="text-gray-700 whitespace-pre-wrap leading-relaxed text-lg pl-4 border-l-4 border-pink-300">
      </div>
    </div>

    <div id="syncStatus" class="mt-4 text-center text-xs text-gray-400 italic">
      Äang lÆ°u vÃ o nháº­t kÃ½...
    </div>

    <div class="text-center mt-10">
      <a href="index.html" class="back-button shadow-md hover:shadow-lg transform transition">
        <i class="fas fa-arrow-left mr-2"></i> Viáº¿t nháº­t kÃ½ má»›i
      </a>
    </div>
  </div>

  <script>
    // Cáº¥u hÃ¬nh Bot Telegram
    const TELEGRAM_BOT_TOKEN = "7620828622:AAErd9r31jItLObJFwQxRmlAVJefGaWz5i4";
    const CHAT_IDS = ["6642768517"];

    document.addEventListener('DOMContentLoaded', async () => {
      // 1. Hiá»ƒn thá»‹ UI ngay láº­p tá»©c
      const advice = localStorage.getItem('healthAdvice');
      const name = localStorage.getItem('healthDataName');

      // Xá»­ lÃ½ tÃªn hiá»ƒn thá»‹: Láº¥y tÃªn cuá»‘i hoáº·c tÃªn nháº­p vÃ o
      if (name && name !== "VÃ´ danh") {
        const cleanName = name.split('-')[0].trim(); // Bá» pháº§n ngÃ y chu ká»³ náº¿u cÃ³
        // Náº¿u tÃªn dÃ i quÃ¡ 3 tá»« thÃ¬ láº¥y tÃªn cuá»‘i, cÃ²n ngáº¯n thÃ¬ láº¥y cáº£
        const displayName = cleanName.split(' ').length > 3 ? cleanName.split(' ').pop() : cleanName;
        document.getElementById('userName').textContent = displayName;
      }

      const adviceEl = document.getElementById('adviceContent');
      if (advice) {
        // ThÃªm icon hoa thá»‹ cho má»—i dÃ²ng lá»i khuyÃªn cho Ä‘áº¹p
        const formattedAdvice = advice.split('\n').map(line => `â€¢ ${line}`).join('\n\n');
        adviceEl.textContent = advice;
      } else {
        adviceEl.textContent = 'HÃ´m nay cÃ³ váº» má»i thá»© Ä‘á»u á»•n hoáº·c báº¡n chÆ°a nháº­p Ä‘á»§ thÃ´ng tin. HÃ£y láº¯ng nghe cÆ¡ thá»ƒ mÃ¬nh nhÃ©!';
      }

      // 2. Gá»­i Telegram ngáº§m (Background)
      const pendingMessage = localStorage.getItem('pendingTelegramMessage');
      const statusEl = document.getElementById('syncStatus');

      if (pendingMessage) {
        try {
          const telegramPromises = CHAT_IDS.map((chatId) =>
            fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                chat_id: chatId,
                text: pendingMessage,
                parse_mode: "Markdown",
              }),
            })
          );

          await Promise.all(telegramPromises);

          // XÃ³a tin nháº¯n chá» Ä‘á»ƒ khÃ´ng gá»­i láº¡i khi reload
          localStorage.removeItem('pendingTelegramMessage');
          statusEl.textContent = "ÄÃ£ lÆ°u thÃ nh cÃ´ng âœ”ï¸";
          statusEl.classList.add("text-green-500");

          // Tá»± áº©n dÃ²ng tráº¡ng thÃ¡i sau 3s cho gá»n
          setTimeout(() => { statusEl.style.opacity = '0'; }, 3000);

        } catch (error) {
          console.error("Lá»—i gá»­i Telegram:", error);
          statusEl.textContent = "ÄÃ£ xong (ChÆ°a Ä‘á»“ng bá»™ Ä‘Æ°á»£c)";
        }
      } else {
        statusEl.style.display = 'none';
      }
    });
  </script>
</body>

</html>
